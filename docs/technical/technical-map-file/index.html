<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/mAtches/blog/rss.xml" title="mAtches Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mAtches/blog/atom.xml" title="mAtches Blog Atom Feed"><title data-react-helmet="true">Proprietary Mapping format | mAtches</title><meta data-react-helmet="true" property="og:url" content="https://pepfar-datim.github.io/mAtches/docs/technical/technical-map-file"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Proprietary Mapping format | mAtches"><meta data-react-helmet="true" name="description" content="mAtches uses a proprietary format (a map) for storing instructions on how to transform users&#x27; data into a QuestionnaireResponse corresponding to the related FHIR Questionnaire."><meta data-react-helmet="true" property="og:description" content="mAtches uses a proprietary format (a map) for storing instructions on how to transform users&#x27; data into a QuestionnaireResponse corresponding to the related FHIR Questionnaire."><link data-react-helmet="true" rel="shortcut icon" href="/mAtches/img/match_color.png"><link data-react-helmet="true" rel="canonical" href="https://pepfar-datim.github.io/mAtches/docs/technical/technical-map-file"><link data-react-helmet="true" rel="alternate" href="https://pepfar-datim.github.io/mAtches/docs/technical/technical-map-file" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pepfar-datim.github.io/mAtches/docs/technical/technical-map-file" hreflang="x-default"><link rel="stylesheet" href="/mAtches/assets/css/styles.14ff55e5.css">
<link rel="preload" href="/mAtches/assets/js/styles.d9aabe9d.js" as="script">
<link rel="preload" href="/mAtches/assets/js/runtime~main.f1d67088.js" as="script">
<link rel="preload" href="/mAtches/assets/js/main.dcb54096.js" as="script">
<link rel="preload" href="/mAtches/assets/js/1.eaa5fc34.js" as="script">
<link rel="preload" href="/mAtches/assets/js/2.83353b3a.js" as="script">
<link rel="preload" href="/mAtches/assets/js/25.4c7308f5.js" as="script">
<link rel="preload" href="/mAtches/assets/js/27.70557bbd.js" as="script">
<link rel="preload" href="/mAtches/assets/js/935f2afb.8359677a.js" as="script">
<link rel="preload" href="/mAtches/assets/js/17896441.4c0fcbec.js" as="script">
<link rel="preload" href="/mAtches/assets/js/670b370f.cd10056e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mAtches/"><img src="/mAtches/img/match_color.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mAtches/img/match_color.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">mAtches Documentation</strong></a><a class="navbar__item navbar__link" href="/mAtches/docs/overview/overview">Overview</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" type="doc" activesidebarclassname="navbar__link--active" href="/mAtches/docs/technical/technical-architecture">Technical</a></li><li><a class="dropdown__link" type="doc" activesidebarclassname="navbar__link--active" href="/mAtches/docs/end_user/endUser-dashboard">End User</a></li><li><a class="dropdown__link" type="doc" activesidebarclassname="navbar__link--active" href="/mAtches/docs/implementation/implementation-deployment">Implementation</a></li></ul></div><a href="https://test.ohie.datim.org/mAtches" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Demo</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/pepfar-datim/mAtches" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/mAtches/"><img src="/mAtches/img/match_color.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mAtches/img/match_color.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">mAtches Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mAtches/docs/overview/overview">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" type="doc" activesidebarclassname="navbar__link--active" href="/mAtches/docs/technical/technical-architecture">Technical</a></li><li class="menu__list-item"><a class="menu__link" type="doc" activesidebarclassname="navbar__link--active" href="/mAtches/docs/end_user/endUser-dashboard">End User</a></li><li class="menu__list-item"><a class="menu__link" type="doc" activesidebarclassname="navbar__link--active" href="/mAtches/docs/implementation/implementation-deployment">Implementation</a></li></ul></li><li class="menu__list-item"><a href="https://test.ohie.datim.org/mAtches" target="_blank" rel="noopener noreferrer" class="menu__link">Demo</a></li><li class="menu__list-item"><a href="https://github.com/pepfar-datim/mAtches" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Technical</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mAtches/docs/technical/technical-architecture">Architecture Summary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mAtches/docs/technical/technical-frontend">Front End</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mAtches/docs/technical/technical-backend">Back End</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mAtches/docs/technical/technical-resources">App Resources</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/mAtches/docs/technical/technical-map-file">Proprietary Mapping format</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mAtches/docs/technical/technical-usermanagement">User Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mAtches/docs/technical/technical-deployment">Deployment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">End User</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/mAtches/docs/end_user/endUser-dashboard">Dashboard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/mAtches/docs/end_user/endUser-edit">Editing a Map</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/mAtches/docs/end_user/endUser-transform">Transforming Data</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Implementation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/mAtches/docs/implementation/implementation-deployment">Deployment</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Proprietary Mapping format</h1></header><div class="markdown"><p>mAtches uses a proprietary format (a map) for storing instructions on how to transform users&#x27; data into a QuestionnaireResponse corresponding to the related FHIR Questionnaire.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="higher-level-properties"></a>Higher-Level Properties<a class="hash-link" href="#higher-level-properties" title="Direct link to heading">#</a></h2><p>Maps have the following properties:</p><table><thead><tr><th>property</th><th>description</th></tr></thead><tbody><tr><td><strong>name</strong></td><td>a user-defined name for the map (must be unique)</td></tr><tr><td><strong>created</strong></td><td>ISO date for when map was created</td></tr><tr><td><strong>updated</strong></td><td>ISO date for when map was last updated</td></tr><tr><td><strong>uid</strong></td><td>a unique 6-character alphanumeric string</td></tr><tr><td><strong>questionnaireuid</strong></td><td>id for the questionnaire the map is linked to. We are currently using url values here, but this depends on the questionnaire ids specified by an organization in the questionnaires uploaded to the FHIR server which stores questionnaires</td></tr><tr><td><strong>complete</strong></td><td>a boolean that records whether a map has satistfied minimum requirements for mappings. To be complete, all required questionnaire items must be mapped. For CSV files, there is a further restriction that there be no unmapped headers (that is a user cannot define a header that they don&#x27;t plan to use when mapping data)</td></tr><tr><td><strong>fileType</strong></td><td>a string value which is either <code>csv</code> or <code>json</code> (the two supported file types)</td></tr><tr><td><strong>headersStructure</strong></td><td>this property is present on maps with <code>json</code> filetype. It is an array of objects which specifies the format of the file the user is mapping against.</td></tr><tr><td><strong>logic</strong></td><td>this property is present on maps with <code>json</code> filetype. It specifies any logic rules for the mappings. Currently, mAtches allows user to specify logic conditions on an array of objects. For example, given the following array <code>[{&quot;quality&quot;: &quot;fluffy&quot;, &quot;animal&quot;: &quot;dog&quot;}, {&quot;quality&quot;: &quot;spikey&quot;, &quot;animal&quot;: &quot;hedgehog&quot;}]</code>, mAtches allows you to specify logic to specify that the user wants to take the value from <code>animal</code> on the object where <code>quality</code> equals <code>fluffy</code> (in this case, this resolves to <code>dog</code>)</td></tr><tr><td><strong>map</strong></td><td>the actual map which stores the instructions for mapping to the relevant FHIR Questionnaire (see below for more details)</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="map-level-properties"></a>Map-Level Properties<a class="hash-link" href="#map-level-properties" title="Direct link to heading">#</a></h2><p>The actual instructions to map the propietary data to the FHIR Questionnaire items is contained in the <code>map</code> property.
Within the map property, there are two subproperties: <code>headers</code> and <code>constants</code>. <code>headers</code> provide the instructions to the data that is present within the data that will be transformed. The <code>constants</code> are used to define situations where a FHIR Questionnaire item uses a constant value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="headers"></a>headers<a class="hash-link" href="#headers" title="Direct link to heading">#</a></h3><p>Each property in <code>headers</code> is a reference to a header (for csv file type) or a path to a value (for json file type) that is used when retrieving the data that should be mapped to the FHIR QuestionnaireResponse.
Note that for csv files, all headers must be mapped. For json files, all valid paths will be present under <code>headers</code>, but it is not required that they be mapped.</p><table><thead><tr><th>property</th><th>description</th></tr></thead><tbody><tr><td><strong>headerPath</strong></td><td>an array of strings that specifies the path to the item being mapped. For example, if the fileType is csv, and the header to be mapped is <code>DateOfBirth</code>, the headerPath will be <code>[&#x27;DateOfBirth&#x27;]</code>. If the fileType is json, and the path to the value is <code>patient.name.first</code>, the headerPath is <code>[&#x27;patient&#x27;,&#x27;name&#x27;,&#x27;first&#x27;]</code></td></tr><tr><td><strong>path</strong></td><td>this is the path to the FHIR Questionnaire item being mapped to</td></tr><tr><td><strong>valueType</strong></td><td>the valueType of the Questionnaire item</td></tr><tr><td><strong>choiceMap</strong></td><td>this is present if the valueType is choice and provides a mapping to valid choice values. An example is <code>&quot;F&quot;&quot;: {&quot;code&quot;: &quot;Female&quot;, &quot;valueType&quot;: &quot;choice&quot;}</code>; here the user has indicated that the value <code>F</code> in their system corresponds to the expected value of <code>Female</code> as defined by the FHIR Questionnaire item&#x27;s <code>answerValueSet</code> or <code>answerOption</code></td></tr><tr><td><strong>logic</strong></td><td>this is present if value is being provided by way of a logic definition defined for mapping (only applicable for json files). In this case, the &quot;header&quot; will refer to the alias of the logic definition. See below for details on structure</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="constants"></a>constants<a class="hash-link" href="#constants" title="Direct link to heading">#</a></h3><p>Each property in <code>constants</code> is a reference to the last <code>linkid</code> in a FHIR Questionnaire item&#x27;s path. For example, if a FHIR item has a path that ends with a <code>linkid</code> of <code>Patient/ID</code> and this item is mapped to a constant, then the <code>constants</code> property will have a property <code>Patient/ID</code></p><p>Within each property of the <code>constants</code> resource, one can find the following properties:</p><table><thead><tr><th>property</th><th>description</th></tr></thead><tbody><tr><td><strong>display</strong></td><td>the mapping constant as it is displayed on the front end. If a user specifies that a patientID is always <code>123</code>, <code>123</code> will be saved here</td></tr><tr><td><strong>code</strong></td><td>a code for the mapping constant. This is relevant if the item is a <code>choice</code> value type, in which case the display value may differ from the code. If user defines (rather than selects) the constant, this will be the same as display.</td></tr><tr><td><strong>valueType</strong></td><td>the valueType of the Questionnaire item</td></tr><tr><td><strong>path</strong></td><td>this is the path from the FHIR Questionnaire item for which a constant is being provided</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="logic-definitions"></a>logic definitions<a class="hash-link" href="#logic-definitions" title="Direct link to heading">#</a></h3><p>The logic definitions use the format specified below. For simplification purposes, imagine that we have an array of objects <code>[{&quot;quality&quot;: &quot;fluffy&quot;, &quot;animal&quot;: &quot;dog&quot;}, {&quot;quality&quot;: &quot;spikey&quot;, &quot;animal&quot;: &quot;hedgehog&quot;}]</code>, and we want to us the value from <code>animal</code> on the object where <code>quality</code> equals <code>fluffy</code> (in this case, this resolves to <code>dog</code>).</p><table><thead><tr><th>property</th><th>description</th></tr></thead><tbody><tr><td><strong>operator</strong></td><td>the following operators are allowed: <code>eq</code> (equals), <code>gt</code> (greater than), <code>lt</code> (less than). The first value that satisfies a given logic condition is selected</td></tr><tr><td><strong>logicKey</strong></td><td>the property against which the logic is checked. In the example, this is <code>quality</code></td></tr><tr><td><strong>logicCondition</strong></td><td>the value the logicKey must satisfy. In the example, this is <code>fluffy</code></td></tr><tr><td><strong>selectKey</strong></td><td>the property from which value is taken if logic is fulfilled. In the example, this is <code>animal</code></td></tr><tr><td><strong>alias</strong></td><td>A user specified name for this logic definition (used within UI); defaults to fhirPath if not provided</td></tr><tr><td><strong>fhirPath</strong></td><td>fhirPath definition of logic rule</td></tr><tr><td><strong>headerPath</strong></td><td>path to the parent property on which this logic rule is applied</td></tr><tr><td><strong>itemPath</strong></td><td>specifies the path for accessing the item as used in headersStructure</td></tr><tr><td><strong>id</strong></td><td>six-character alphanumeric generated by mAtches for managing logic definitions</td></tr></tbody></table></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/pepfar-datim/mAtches/edit/master/documentation/docs/technical/technical-file-format.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mAtches/docs/technical/technical-resources"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« App Resources</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mAtches/docs/technical/technical-usermanagement"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User Management »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#higher-level-properties" class="table-of-contents__link">Higher-Level Properties</a></li><li><a href="#map-level-properties" class="table-of-contents__link">Map-Level Properties</a><ul><li><a href="#headers" class="table-of-contents__link">headers</a></li><li><a href="#constants" class="table-of-contents__link">constants</a></li><li><a href="#logic-definitions" class="table-of-contents__link">logic definitions</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mAtches/docs/technical/technical-architecture">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://ohie.org/duc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Use Community</a></li><li class="footer__item"><a href="https://ohie.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenHIE</a></li><li class="footer__item"><a href="https://www.state.gov/pepfar/" target="_blank" rel="noopener noreferrer" class="footer__link-item">PEPFAR</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pepfar-datim/mAtches" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 PEPFAR.</div></div></div></footer></div>
<script src="/mAtches/assets/js/styles.d9aabe9d.js"></script>
<script src="/mAtches/assets/js/runtime~main.f1d67088.js"></script>
<script src="/mAtches/assets/js/main.dcb54096.js"></script>
<script src="/mAtches/assets/js/1.eaa5fc34.js"></script>
<script src="/mAtches/assets/js/2.83353b3a.js"></script>
<script src="/mAtches/assets/js/25.4c7308f5.js"></script>
<script src="/mAtches/assets/js/27.70557bbd.js"></script>
<script src="/mAtches/assets/js/935f2afb.8359677a.js"></script>
<script src="/mAtches/assets/js/17896441.4c0fcbec.js"></script>
<script src="/mAtches/assets/js/670b370f.cd10056e.js"></script>
</body>
</html>